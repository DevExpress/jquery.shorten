(function($){var shortenTextRegex=/\"/g;$.fn.shorten=function(settings){"use strict";var config={showChars:100,minHideChars:10,ellipsesText:"...",moreText:"more",lessText:"less",onLess:function(){},onMore:function(){},errMsg:null,force:!1,showTooltip:!0,showPopover:!1};if(settings){$.extend(config,settings)}
if($(this).data('jquery.shorten')&&!config.force){return!1}
$(this).data('jquery.shorten',!0);$(document).off("click",'.morelink');$(document).on({click:function(){var $this=$(this);if($this.hasClass('less')){$this.removeClass('less');$this.html(config.moreText);$this.parent().prev().animate({'height':'0'+'%'},function(){$this.parent().prev().prev().show()}).hide('fast',function(){config.onLess()})}else{$this.addClass('less');$this.html(config.lessText);$this.parent().prev().animate({'height':'100'+'%'},function(){$this.parent().prev().prev().hide()}).show('fast',function(){config.onMore()})}
return!1}},'.morelink');return this.each(function(){var $this=$(this);var content=$this.html();var contentlen=$this.text().length;if(contentlen>config.showChars+config.minHideChars){var c=content.substr(0,config.showChars);if(c.indexOf('<')>=0)
{var inTag=!1;var bag='';var countChars=0;var openTags=[];var tagName=null;for(var i=0,r=0;r<=config.showChars;i++){if(content[i]=='<'&&!inTag){inTag=!0;tagName=content.substring(i+1,content.indexOf('>',i));if(tagName[0]=='/'){if(tagName!='/'+openTags[0]){config.errMsg='ERROR en HTML: the top of the stack should be the tag that closes'}else{openTags.shift()}}else{if(tagName.toLowerCase()!='br'){openTags.unshift(tagName)}}}
if(inTag&&content[i]=='>'){inTag=!1}
if(inTag){bag+=content.charAt(i)}
else{r++;if(countChars<=config.showChars){bag+=content.charAt(i);countChars++}else{if(openTags.length>0)
{for(var j=0;j<openTags.length;j++){bag+='</'+openTags[j]+'>'}
break}}}}
c=$('<div/>').html(bag+'<span class="ellip">'+config.ellipsesText+'</span>').html()}else{c+=config.ellipsesText}
var html='<div class="shortcontent">'+c+'</div><div class="allcontent">'+content+'</div><span><a href="javascript://nop/" class="morelink"';var text=$this.text().replace(shortenTextRegex,"'");if(config.showTooltip)
html+=' data-toggle="tooltip" title="'+text+'"';if(config.showPopover)
html+=' data-toggle="popover" data-content="'+text+'"';html+='>'+config.moreText+'</a></span>';$this.html(html);var allContent=$this.find(".allcontent");allContent.hide();$('.shortcontent p:last',$this).css('margin-bottom',0);var where=$this.find('.morelink');$(document).trigger('afterShorten',[$this,allContent,where])}})}})(jQuery)
